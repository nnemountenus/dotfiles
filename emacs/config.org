#+TITLE: Emacs Configuration
#+AUTHOR: Nnemo Untenus
#+OPTIONS: num:nil

Так, это мой конфиг .emacs, сделанный в виде Org файла.
Он загружается с помощью Org-babel.

* Репозитории и стандартные пакеты
** Melpa
Репозиторий, который содержит очень ОЧЕНЬ много пакетов
для EMACS.

#+BEGIN_SRC emacs-lisp
 (add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/"))
 (package-initialize)
#+END_SRC

** Синхронизация окружения оболочки и EMACS
#+BEGIN_SRC emacs-lisp
 (when (memq window-system '(mac ns x))
 (exec-path-from-shell-initialize))
#+END_SRC
** Без стартового окна и сообщения
#+BEGIN_SRC emacs-lisp
 (setq inhibit-splash-screen   t)
 (setq ingibit-startup-message t)
#+END_SRC
** Использование русской раскладки
#+BEGIN_SRC emacs-lisp
 (defun cfg:reverse-input-method (input-method)
  "Build the reverse mapping of single letters from INPUT-METHOD."
  (interactive
   (list (read-input-method-name "Use input method (default current): ")))
  (if (and input-method (symbolp input-method))
      (setq input-method (symbol-name input-method)))
  (let ((current current-input-method)
        (modifiers '(nil (control) (meta) (control meta))))
    (when input-method
      (activate-input-method input-method))
    (when (and current-input-method quail-keyboard-layout)
      (dolist (map (cdr (quail-map)))
        (let* ((to (car map))
               (from (quail-get-translation
                      (cadr map) (char-to-string to) 1)))
          (when (and (characterp from) (characterp to))
            (dolist (mod modifiers)
              (define-key local-function-key-map
                (vector (append mod (list from)))
                (vector (append mod (list to)))))))))
    (when input-method
      (activate-input-method current))))

(cfg:reverse-input-method 'russian-computer)
#+END_SRC
** Сохранять сессию при выходе
#+BEGIN_SRC emacs-lisp
 (desktop-save-mode 1)
#+END_SRC
* Внешний вид
** Удаление компонентов GUI
*** Удаление подсказок
#+BEGIN_SRC emacs-lisp
 (tooltip-mode      -1)
#+END_SRC
*** Удаление графического меню
#+BEGIN_SRC emacs-lisp
 (menu-bar-mode     -1)
#+END_SRC
*** Удаление тулбара
#+BEGIN_SRC emacs-lisp
 (tool-bar-mode     -1)
#+END_SRC
*** Удаление полосы прокрутки
#+BEGIN_SRC emacs-lisp
 (scroll-bar-mode   -1)
#+END_SRC
*** Курсор не мигает
#+BEGIN_SRC emacs-lisp
 (blink-cursor-mode -1)
#+END_SRC
*** Без графических диалогов и окон
#+BEGIN_SRC emacs-lisp
 (setq use-dialog-box     nil)
#+END_SRC
*** Лучшая прорисовка буфера
#+BEGIN_SRC emacs-lisp
 (setq redisplay-dont-pause t)
#+END_SRC
*** Отключить звуковой сигнал
#+BEGIN_SRC emacs-lisp
 (setq ring-bell-function 'ignore)
#+END_SRC
** Настройка mode-line
*** 24-часовой формат времени
#+BEGIN_SRC emacs-lisp
 (setq display-time-24hr-format t)
#+END_SRC
*** Показывать часы
#+BEGIN_SRC emacs-lisp
(display-time-mode             t)
#+END_SRC
*** Показывать размер файла в %
#+BEGIN_SRC emacs-lisp
 (size-indication-mode          t)
#+END_SRC
** Имя текущего буфера в заголовке 
#+BEGIN_SRC emacs-lisp
 (setq frame-title-format "GNU Emacs: %b")
#+END_SRC
** Тема
#+BEGIN_SRC emacs-lisp
 (load-theme 'hc-zenburn t)
#+END_SRC
* Режимы работы
** Общее
*** Никогда не использовать табы, отступ 2
#+BEGIN_SRC emacs-lisp
 (setq-default
 indent-tabs-mode nil
 c-basic-indent 2
 c-basic-offset 2
 tab-width 2)
#+END_SRC
** Разработка
*** Автодополнение
#+BEGIN_SRC emacs-lisp
 (require 'auto-complete)
 (require 'auto-complete-config)
 (ac-config-default)
#+END_SRC
*** Выделять выражения между скобками
#+BEGIN_SRC emacs-lisp
 (show-paren-mode t)
 (setq show-paren-style 'expression)
#+END_SRC
*** Отключить выравнивание electric (оно работает не очень)
#+BEGIN_SRC emacs-lisp
 (electric-indent-mode -1)
#+END_SRC
*** Включить парные скобки
#+BEGIN_SRC emacs-lisp
 (electric-pair-mode 1)
#+END_SRC
*** Подсвечивать результат поиска и замены
#+BEGIN_SRC emacs-lisp
 (setq search-highlight        t)
 (setq query-replace-highlight t)
#+END_SRC
** Org
*** Установка
#+BEGIN_SRC emacs-lisp
 (require 'org-install)
#+END_SRC
*** Ассоциация с .org файлами
#+BEGIN_SRC emacs-lisp
 (add-to-list 'auto-mode-alist '("\\.org$" . org-mode))
 (setq org-log-don t)
#+END_SRC
*** Добавление Org-babel
#+BEGIN_SRC emacs-lisp
 (setq org-plantuml-jar-path (expand-file-name "/home/nnemo/.emacs.d/plantuml.jar"))
 (with-eval-after-load "org"
   (add-to-list 'org-src-lang-modes '("plantuml" . plantuml)))

 (setq org-babel-python-command "python3")

 (org-babel-do-load-languages
  'org-babel-load-languages
  '((R . t)
    (emacs-lisp . t)
    (python . t)
    (plantuml . t)))
 (setq org-src-fontify-natively t)
#+END_SRC
*** Красивые маркеры в Org
#+BEGIN_SRC emacs-lisp
 (require 'org-bullets)
 (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))
#+END_SRC
** Dired
*** Установка
#+BEGIN_SRC emacs-lisp
(require 'dired)
(setq dired-recursive-deleter 'top)
#+END_SRC
*** Сокращенный режим (спасибо Xah Lee)
#+BEGIN_SRC emacs-lisp
 (defun xah-dired-mode-setup ()
  "to be run as hook for `dired-mode'."
  (dired-hide-details-mode 1))
(add-hook 'dired-mode-hook 'xah-dired-mode-setup)
#+END_SRC
*** Не показывать скрытые файлы
#+BEGIN_SRC emacs-lisp
 (defun my-dired-mode-hook ()
  "My `dired' mode hook."
  (dired-hide-dotfiles-mode))
#+END_SRC
*** Скрыть/показать скрытые по "."
#+BEGIN_SRC emacs-lisp
 (define-key dired-mode-map "." #'dired-hide-dotfiles-mode)
 (add-hook 'dired-mode-hook #'my-dired-mode-hook)
#+END_SRC
** iBuffer
*** Добавление и замена list-buffers
#+BEGIN_SRC emacs-lisp
 (require 'bs)
 (require 'ibuffer)
 (defalias 'list-buffers 'ibuffer) 
#+END_SRC
*** Группирование по GIT-проектам
#+BEGIN_SRC emacs-lisp
 (add-hook 'ibuffer-hook
          (lambda ()
            (ibuffer-vc-set-filter-groups-by-vc-root)
            (unless (eq ibuffer-sorting-mode 'alphabetic)
              (ibuffer-do-sort-by-alphabetic))))
#+END_SRC
*** Поддержка группирования GIT на удаленных машинах
#+BEGIN_SRC emacs-lisp
 (setq ibuffer-vc-skip-if-remote nil)
#+END_SRC
